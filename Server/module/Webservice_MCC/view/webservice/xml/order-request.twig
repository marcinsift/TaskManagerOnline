<?xml version="1.0" encoding="utf-8"?>
<ORDER xmlns="http://www.opentrans.org/XMLSchema/2.1" xmlns:bmecat="http://www.bmecat.org/bmecat/2005"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.opentrans.org/XMLSchema/2.1 opentrans_2_1.xsd" version="2.1" type="standard">
    <ORDER_HEADER>
        <ORDER_INFO>
            <ORDER_ID>{{ order.OrderId }}</ORDER_ID>
            <ORDER_DATE>{{ order.OrderDate|date("Y-m-d") }}</ORDER_DATE>
            <PARTIES>
                <PARTY>
                    <bmecat:PARTY_ID type="supplier_specific">{{ companyId }}</bmecat:PARTY_ID>
                    <PARTY_ROLE>buyer</PARTY_ROLE>
                    <ADDRESS>
                        <bmecat:NAME>{{ order.CompanyName }}</bmecat:NAME>
                        <bmecat:STREET>{{ order.CompanyStreet }}</bmecat:STREET>
                        <bmecat:ZIP>{{ order.CompanyZip }}</bmecat:ZIP>
                        <bmecat:CITY>{{ order.CompanyCity }}</bmecat:CITY>
                        <bmecat:COUNTRY>{{ order.CompanyCountry }}</bmecat:COUNTRY>
                        <bmecat:COUNTRY_CODED>{{ order.CompanyCountryCoded }}</bmecat:COUNTRY_CODED>
                        <bmecat:PHONE>{{ order.CompanyPhone }}</bmecat:PHONE>
                        <bmecat:EMAIL>{{ order.CompanyEmail }}</bmecat:EMAIL>
                    </ADDRESS>
                </PARTY>
                <PARTY>
                    <bmecat:PARTY_ID type="supplier_specific">ACTION EUROPE</bmecat:PARTY_ID>
                    <PARTY_ROLE>supplier</PARTY_ROLE>
                    <ADDRESS>
                        <bmecat:NAME>ACTION EUROPE GmbH</bmecat:NAME>
                        <bmecat:STREET>Kocherstra√üe 2</bmecat:STREET>
                        <bmecat:ZIP>38120</bmecat:ZIP>
                        <bmecat:CITY>Braunschweig</bmecat:CITY>
                        <bmecat:COUNTRY>Deutschland</bmecat:COUNTRY>
                        <bmecat:COUNTRY_CODED>DE</bmecat:COUNTRY_CODED>
                    </ADDRESS>
                </PARTY>
                <PARTY>
                    <bmecat:PARTY_ID type="supplier_specific">{{ companyId }}</bmecat:PARTY_ID>
                    <PARTY_ROLE>delivery</PARTY_ROLE>
                    <ADDRESS>
                        <bmecat:NAME>{{ order.DeliveryName }}</bmecat:NAME>
                        <bmecat:STREET>{{ order.DeliveryStreet }}</bmecat:STREET>
                        <bmecat:ZIP>{{ order.DeliveryZip }}</bmecat:ZIP>
                        <bmecat:CITY>{{ order.DeliveryCity }}</bmecat:CITY>
                        <bmecat:COUNTRY_CODED>{{ order.DeliveryCountryCoded }}</bmecat:COUNTRY_CODED>
                        {% if not order.DeliveryPhone is empty %}
                            <bmecat:PHONE>{{ order.DeliveryPhone }}</bmecat:PHONE>
                        {% endif %}
                        {% if not order.DeliveryEmail is empty %}
                            <bmecat:EMAIL>{{ order.DeliveryEmail }}</bmecat:EMAIL>
                        {% endif %}
                    </ADDRESS>
                </PARTY>
                <PARTY>
                    <bmecat:PARTY_ID type="supplier_specific">{{ companyId }}</bmecat:PARTY_ID>
                    <PARTY_ROLE>invoice_recipient</PARTY_ROLE>
                    <ADDRESS>
                        <bmecat:NAME>{{ order.CompanyName }}</bmecat:NAME>
                        <bmecat:STREET>{{ order.CompanyStreet }}</bmecat:STREET>
                        <bmecat:ZIP>{{ order.CompanyZip }}</bmecat:ZIP>
                        <bmecat:CITY>{{ order.CompanyCity }}</bmecat:CITY>
                        <bmecat:COUNTRY_CODED>{{ order.CompanyCountryCoded }}</bmecat:COUNTRY_CODED>
                        {% if not order.CompanyPhone is empty %}
                            <bmecat:PHONE>{{ order.CompanyPhone }}</bmecat:PHONE>
                        {% endif %}
                        {% if not order.CompanyEmail is empty %}
                            <bmecat:EMAIL>{{ order.CompanyEmail }}</bmecat:EMAIL>
                        {% endif %}
                    </ADDRESS>
                </PARTY>
            </PARTIES>
            <CUSTOMER_ORDER_REFERENCE>
                <ORDER_ID>{{ order.LabelOrderId }}</ORDER_ID>
                <ORDER_DATE>{{ order.LabelOrderDate|date("Y-m-d") }}</ORDER_DATE>
                <ORDER_DESCR>{{ order.LabelOrderDescription }}</ORDER_DESCR>
            </CUSTOMER_ORDER_REFERENCE>
            <ORDER_PARTIES_REFERENCE>
                <bmecat:BUYER_IDREF type="supplier_specific">{{ companyId }}</bmecat:BUYER_IDREF>
                <bmecat:SUPPLIER_IDREF type="supplier_specific">ACTION EUROPE</bmecat:SUPPLIER_IDREF>
                <INVOICE_RECIPIENT_IDREF type="supplier_specific">{{ companyId }}</INVOICE_RECIPIENT_IDREF>
                <SHIPMENT_PARTIES_REFERENCE>
                    <DELIVERY_IDREF type="supplier_specific">{{ companyId }}</DELIVERY_IDREF>
                </SHIPMENT_PARTIES_REFERENCE>
            </ORDER_PARTIES_REFERENCE>
            <bmecat:CURRENCY>EUR</bmecat:CURRENCY>
            <PARTIAL_SHIPMENT_ALLOWED>false</PARTIAL_SHIPMENT_ALLOWED>
            <REMARKS type="ordertype">Fulfillment</REMARKS>
        </ORDER_INFO>
    </ORDER_HEADER>
    <ORDER_ITEM_LIST>
    {% for orderItem in order.OrderItems %}
        <ORDER_ITEM>
            <LINE_ITEM_ID>{{ loop.index }}</LINE_ITEM_ID>
            <PRODUCT_ID>
                <bmecat:SUPPLIER_PID>{{ orderItem.SupplierPid }}</bmecat:SUPPLIER_PID>
                <bmecat:INTERNATIONAL_PID type="EAN">{{ orderItem.InternationalPid }}</bmecat:INTERNATIONAL_PID>
                <bmecat:DESCRIPTION_SHORT>{{ orderItem.DescriptionShort }}</bmecat:DESCRIPTION_SHORT>
            </PRODUCT_ID>
            <QUANTITY>{{ orderItem.Quantity }}</QUANTITY>
            <bmecat:ORDER_UNIT>C62</bmecat:ORDER_UNIT>
            <PRODUCT_PRICE_FIX>
                <bmecat:PRICE_AMOUNT>{{ orderItem.PriceFix }}</bmecat:PRICE_AMOUNT>
            </PRODUCT_PRICE_FIX>
            <PRICE_LINE_AMOUNT>{{ (orderItem.PriceFix * orderItem.Quantity)|number_format(2, '.') }}</PRICE_LINE_AMOUNT>
        </ORDER_ITEM>
    {% endfor %}
    </ORDER_ITEM_LIST>
    <ORDER_SUMMARY>
        <TOTAL_ITEM_NUM>{{ order.TotalItems }}</TOTAL_ITEM_NUM>
        <TOTAL_AMOUNT>{{ order.OrderTotal|number_format(2, '.') }}</TOTAL_AMOUNT>
    </ORDER_SUMMARY>
</ORDER>