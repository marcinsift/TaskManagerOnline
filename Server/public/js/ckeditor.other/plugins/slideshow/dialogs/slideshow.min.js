function removeDomainFromUrl(g){return g.replace(/^https?:\/\/[^\/]+/i,"")}function var_dump(g,i){var j="";i||(i=0);var q,h="";for(q=0;i+1>q;q+=1)h+="    ";if("object"==typeof g){var l,m;for(l in g)g.hasOwnProperty(l)&&(m=g[l],"object"==typeof m?(j+=h+"'"+l+"' ...\n",j+=var_dump(m,i+1)):j+=h+"'"+l+"' => \""+m+'"\n')}else j="===>"+g+"<===("+typeof g+")";return j}
var IMG_PARAM={URL:0,TITLE:1,ALT:2,WIDTH:3,HEIGHT:4},pluginPath=removeDomainFromUrl(CKEDITOR.plugins.get("slideshow").path),BASE_PATH=removeDomainFromUrl(CKEDITOR.basePath),SCRIPT_JQUERY=pluginPath+"3rdParty/jquery.min.js",SCRIPT_ADDGAL=pluginPath+"3rdParty/ad-gallery/jquery.ad-gallery.min.js",CSS_ADDGAL=pluginPath+"3rdParty/ad-gallery/jquery.ad-gallery.css",SCRIPT_FANCYBOX=pluginPath+"3rdParty/fancybox2/jquery.fancybox.pack.js?v=2.1.5",CSS_FANCYBOX=pluginPath+"3rdParty/fancybox2/jquery.fancybox.css?v=2.1.5",
listItem=function(g){return g.type==CKEDITOR.NODE_ELEMENT&&g.is("li")},ULItem=function(g){return g.type==CKEDITOR.NODE_ELEMENT&&g.is("ul")},iFrameItem=function(g){return g.type==CKEDITOR.NODE_ELEMENT&&g.is("iframe")};Array.prototype.pushUnique=function(g){var i;for(i=0;i<this.length;i+=1)if(this[i][0]==g[0])return-1;return this.push(g),this.length-1};Array.prototype.updateVal=function(g,i){var j;for(j=0;j<this.length;j+=1)if(this[j][0]==g)return this[j]=[g,i],!0;return this[j]=[g,i],!1};
Array.prototype.getVal=function(g){var i;for(i=0;i<this.length;i+=1)if(this[i][0]==g)return this[i][1];return null};
CKEDITOR.dialog.add("slideshowDialog",function(g){function i(a,b,c,e,d){var a=h(a),n;return n=e?e.createElement("OPTION"):document.createElement("OPTION"),a&&n&&"option"==n.getName()?(CKEDITOR.env.ie?(isNaN(parseInt(d,10))?a.$.options.add(n.$):a.$.options.add(n.$,d),n.$.innerHTML=0<b.length?b:"",n.$.value=c):(null!==d&&d<a.getChildCount()?a.getChild(0>d?0:d).insertBeforeMe(n):a.append(n),n.setText(0<b.length?b:""),n.setValue(c)),n):!1}function j(a){return a=h(a),a?a.$.selectedIndex:-1}function q(a,
b){if(a=h(a),0>b)return null;var c=a.getChildren().count();return a.$.selectedIndex=b>=c?c-1:b,a}function h(a){return a&&a.domId&&a.getInputElement().$?a.getInputElement():a&&a.$?a:!1}function l(a){1!=a.openCloseStep&&(a.getContentElement("slideshowinfoid","framepreviewid").isVisible()?t(a):r(a))}function m(a){a=a.getContentElement("slideshowinfoid","imglistitemsid");return j(a)}function r(a){var b=a.getContentElement("slideshowinfoid","imglistitemsid"),b=j(b),c=a.imagesList[b],b=a.getContentElement("slideshowinfoid",
"imgtitleid"),b=h(b);b.setValue(c[1]);b=a.getContentElement("slideshowinfoid","imgdescid");b=h(b);b.setValue(c[2]);b=a.getContentElement("slideshowinfoid","imgpreviewid");b=h(b);b.setHtml('<div style="text-align:center;"> <img src="'+c[0]+'" title="'+c[1]+'" alt="'+c[2]+'" style=" max-height: 200px;  max-width: 350px;"> </div>');b=a.getContentElement("slideshowinfoid","framepreviewid");a=a.getContentElement("slideshowinfoid","imgparamsid");b=h(b);b.hide();a=h(a);a.show()}function u(a,b){var c=a.getContentElement("slideshowinfoid",
"imglistitemsid"),c=h(c),e=j(c);if(1!=c.getChildren().count()&&(-1!=b||0!=e))if(1!=b||e!=c.getChildren().count()-1){var d=c,n=a.getParentEditor().document,d=h(d),c=j(d);if(!(0>c)&&(e=c+b,!(e=0>e?0:e,e=e>=d.getChildCount()?d.getChildCount()-1:e,c==e))){var g=/(^IMG_\d+)/,f=d.getChild(e),l=f.getText(),k=f.getValue(),l=l.replace(g,"IMG_"+c);var m,f=e;if(!(m=h(d),0>f))f=m.getChild(f),f.setText(l),f.setValue(k);f=d.getChild(c);l=f.getText();k=f.getValue();f.remove();l=l.replace(g,"IMG_"+e);i(d,l,k,n?n:
null,e);q(d,e);d=a.imagesList[c];a.imagesList[c]=a.imagesList[e];a.imagesList[e]=d}v(a)}}function t(a){var b=a.getContentElement("slideshowinfoid","framepreviewid"),c=a.getContentElement("slideshowinfoid","imgparamsid"),c=h(c);c.hide();b=h(b);b.show();v(a)}function v(a){var b=300;if(1==a.params.getVal("showthumbid")?b-=120:1==a.params.getVal("showcontrolid")&&(b-=30),0!=a.imagesList.length){var c=a.getContentElement("slideshowinfoid","imglistitemsid"),e=j(c);0>e&&(e=0);var c=a.getContentElement("slideshowinfoid",
"framepreviewid"),d="",d=d+"<head>",d=d+('<script src="'+SCRIPT_JQUERY+'" type="text/javascript"><\/script>'),d=d+('<script type="text/javascript" src="'+SCRIPT_ADDGAL+'"><\/script>'),d=d+('<link rel="stylesheet" type="text/css" href="'+CSS_ADDGAL+'" />');1==a.params.getVal("openOnClickId")&&(d+='<link rel="stylesheet" type="text/css" href="'+CSS_FANCYBOX+'" />',d+='<script type="text/javascript" src="'+SCRIPT_FANCYBOX+'"><\/script>',d+='<script type="text/javascript">',d+=w(a),d+="<\/script>");d+=
'<script type="text/javascript">';d+=x(a,e,436,b);d+="<\/script>";d+="</head>";d+="<body>";e=y(a);d+=e.getOuterHtml();d+="</body>";d+="";c=h(c);(e=c.getFirst(iFrameItem))&&e.remove();var f=null;1==a.params.getVal("showthumbid")?b+=120:1==a.params.getVal("showcontrolid")&&(b+=30);a=CKEDITOR.dom.element.createFromHtml('<iframe style="width:496px;height:'+b+'px;background:azure; " class="cke_pasteframe" frameborder="10"  allowTransparency="false" role="region" scrolling="no"></iframe>');a.setAttribute("name",
"totoFrame");a.setAttribute("id","totoFrame");a.on("load",function(){if(null==f){f=this.$;var a;f.contentDocument?a=f.contentDocument:f.contentWindow&&(a=f.contentWindow.document);if(a){var b=d;a.open();a.writeln(b);a.close()}else alert("Cannot inject dynamic contents into iframe.")}});c.append(a)}}function p(){var a=this.getDialog();if(a.newSlideShowMode)a.slideshowDOM.setAttribute("data-"+this.id,this.getValue());else switch(this.type){case "checkbox":this.setValue("true"==a.slideshowDOM.getAttribute("data-"+
this.id));break;case "text":this.setValue(a.slideshowDOM.getAttribute("data-"+this.id));break;case "select":this.setValue(a.slideshowDOM.getAttribute("data-"+this.id))}}function k(){var a=this.getDialog();a.params.updateVal(this.id,this.getValue());l(a)}function z(a){a.previewImage&&(a.previewImage.removeListener("load",s),a.previewImage.removeListener("error",o),a.previewImage.removeListener("abort",o),a.previewImage.remove(),a.previewImage=null);a.imagesList=null;a.params=null;a.slideshowDOM=null;
for(var b=a.getContentElement("slideshowinfoid","imglistitemsid"),b=h(b);b.getChild(0)&&b.getChild(0).remove(););a.openCloseStep=!1}function A(a){for(var b="";b.length<a;)b+=Math.random().toString(36).substring(2);return b.substring(0,a)}function x(a,b,c,e){var d="ad-gallery_"+a.params.getVal("slideshowid"),g,i="";g="(function($) {$(function() {";0==e&&(e=a.params.getVal("pictheightid"));0==c&&(c="false");0==a.params.getVal("showtitleid")&&(i=",  hooks: { displayDescription: function(image) {}}");
b="loader_image: '"+pluginPath+"3rdParty/ad-gallery/loader.gif', width:"+c+", height:"+e+", start_at_index: "+b+", animation_speed: "+a.params.getVal("animspeedid")+i+", update_window_hash: false, effect: '"+a.params.getVal("transitiontypeid")+"',";a=" slideshow: { enable: true, autostart: "+a.params.getVal("autostartid")+", start_label: '"+f.labelStart+"', stop_label: '"+f.labelStop+"', speed: "+1E3*a.params.getVal("speedid")+"}";return g+="   var galleries = $('#"+d+"').adGallery({"+b+a+"});",g+=
"});",g+"})(jQuery);"}function w(a){var a="ad-gallery_"+a.params.getVal("slideshowid"),b="(function($) {";return b+="$(function() {",b+='$("#'+a+'").on("click",".ad-image",function(){',b+='var imgObj =$(this).find("img");',b+='var isrc=imgObj.attr("src");',b+="var ititle=null;",b+="var idesc=null;",b+="var iname=isrc.split('/');",b+="iname=iname[iname.length-1];",b+='var imgdescid=$(this).find(".ad-image-description");',b+="if(imgdescid){",b+='ititle=$(this).find(".ad-description-title");',b+="if(ititle)ititle=ititle.text();",
b+="if(ititle!='')ititle='<big>'+ititle+'</big>';",b+='idesc=$(this).find("span");',b+="if(idesc)idesc=idesc.text();",b+="if(idesc!=''){",b+="if(ititle!='')ititle=ititle+'<br>';",b+="idesc='<i>'+idesc+'</i>';",b+="}",b+="}",b+="$.fancybox.open({",b+="href:isrc,",b+="beforeLoad:function(){",b+="this.title=ititle+idesc;",b+="},",b+="});",b+="});",b+="});",b+"})(jQuery);"}function y(a){var b=a.params.getVal("slideshowid"),c="ad-gallery_"+b,e="display: block;",d="display: block;";0==a.params.getVal("showthumbid")&&
(e="display: none;");0==a.params.getVal("showcontrolid")&&(d="visibility: hidden;");var f=g.document.createElement("div");f.setAttribute("id",b);f.setAttribute("class","slideshowPlugin");f.setAttribute("contenteditable","false");b=f.append("div");b.setAttribute("class","ad-gallery");b.setAttribute("contenteditable","false");b.setAttribute("id",c);c=b.append("div");c.setAttribute("class","ad-image-wrapper");c.setAttribute("contenteditable","false");c=b.append("div");c.setAttribute("class","ad-controls");
c.setAttribute("contenteditable","false");c.setAttribute("style",d);d=b.append("div");d.setAttribute("class","ad-nav");d.setAttribute("style",e);d.setAttribute("contenteditable","false");e=d.append("div");e.setAttribute("class","ad-thumbs");e.setAttribute("contenteditable","false");e=e.append("ul");e.setAttribute("class","ad-thumb-list");e.setAttribute("contenteditable","false");for(d=0;d<a.imagesList.length;d+=1)b=e.append("li"),b.setAttribute("contenteditable","false"),b=b.append("a"),b.setAttribute("href",
removeDomainFromUrl(a.imagesList[d][IMG_PARAM.URL])),b.setAttribute("contenteditable","false"),b=b.append("img"),b.setAttribute("src",removeDomainFromUrl(a.imagesList[d][IMG_PARAM.URL])),b.setAttribute("title",a.imagesList[d][IMG_PARAM.TITLE]),b.setAttribute("alt",a.imagesList[d][IMG_PARAM.ALT]),b.setAttribute("contenteditable","false"),b.setAttribute("width",a.imagesList[d][IMG_PARAM.WIDTH]),b.setAttribute("height",a.imagesList[d][IMG_PARAM.HEIGHT]);return f}var f=g.lang.slideshow,s=function(){var a=
this.previewImage;a.removeListener("load",s);a.removeListener("error",o);a.removeListener("abort",o);a=BASE_PATH+"plugins/slideshow/icons/placeholder.png";1==this.imagesList.length&&this.imagesList[0][IMG_PARAM.URL]==a&&(a=this.getContentElement("slideshowinfoid","imglistitemsid"),a=h(a),this.imagesList.splice(0,1),a.getChild(0).remove());var b=this.previewImage,a=b.$.src,c=b.$.width/b.$.height,e=b=50;1<c?e/=c:b*=c;c=this.getContentElement("slideshowinfoid","imglistitemsid");b=this.imagesList.pushUnique([a,
"","",b.toFixed(0),e.toFixed(0)]);0<=b&&(i(c,"IMG_"+b+" : "+a.substring(a.lastIndexOf("/")+1),a,this.getParentEditor().document),q(c,b),l(this))},o=function(){var a=this.previewImage;a.removeListener("load",s);a.removeListener("error",o);a.removeListener("abort",o)};return{title:f.dialogTitle,width:500,height:600,resizable:CKEDITOR.DIALOG_RESIZE_NONE,buttons:[CKEDITOR.dialog.okButton(g,{label:"OkCK",style:"display:none;"}),CKEDITOR.dialog.cancelButton,{id:"myokbtnid",type:"button",label:"OK",title:f.validModif,
accessKey:"C",disabled:!1,onClick:function(){var a=this.getDialog(),b={};a.openCloseStep=!0;a.commitContent(a);var c,e=y(a);for(c=0;c<a.params.length;c+=1)e.data(a.params[c][0],a.params[c][1]);c=CKEDITOR.document.createElement("script",{attributes:{type:"text/javascript",src:SCRIPT_JQUERY}});e.append(c);c=CKEDITOR.document.createElement("script",{attributes:{type:"text/javascript",src:SCRIPT_ADDGAL}});if(e.append(c),1==a.params.getVal("openOnClickId"))c=CKEDITOR.document.createElement("script",{attributes:{type:"text/javascript"}}),
c.setText("(function($) { $('head').append('<link rel=\"stylesheet\" href=\""+CSS_FANCYBOX+'" type="text/css" />\'); })(jQuery);'),e.append(c),c=CKEDITOR.document.createElement("script",{attributes:{type:"text/javascript",src:SCRIPT_FANCYBOX}}),e.append(c),c=CKEDITOR.document.createElement("script",{attributes:{type:"text/javascript"}}),c.setText(w(a)),e.append(c);c=CKEDITOR.document.createElement("script",{attributes:{type:"text/javascript"}});c.setText("(function($) { $('head').append('<link rel=\"stylesheet\" href=\""+
CSS_ADDGAL+'" type="text/css" />\'); })(jQuery);');e.append(c);c=CKEDITOR.document.createElement("script",{attributes:{type:"text/javascript"}});c.setText(x(a,0,0,0));e.append(c);a.imagesList.length&&(b.backgroundImage='url("'+a.imagesList[0][IMG_PARAM.URL]+'")');b.backgroundSize="50%";b.display="block";e=g.createFakeElement(e,"cke_slideShow","slideShow",!1);e.setAttributes({});e.setStyles(b);a.fakeImage?(e.replace(a.fakeImage),g.getSelection().selectElement(e)):g.insertElement(e);z(a);a.hide()}}],
contents:[{id:"slideshowinfoid",label:"Basic Settings",align:"center",elements:[{type:"text",id:"id",style:"display:none;",onLoad:function(){this.getInputElement().setAttribute("readOnly",!0)}},{type:"text",id:"txturlid",style:"display:none;",label:f.imgList,onChange:function(){var a=this.getDialog(),b=this.getValue();if(0<b.length){var c=a.previewImage;c.on("load",s,a);c.on("error",o,a);c.on("abort",o,a);c.setAttribute("src",b)}}},{type:"button",id:"browse",hidden:"true",style:"display:inline-block;margin-top:0px;",
filebrowser:{action:"Browse",target:"slideshowinfoid:txturlid",url:g.config.filebrowserImageBrowseUrl||g.config.filebrowserBrowseUrl},label:f.imgAdd},{type:"vbox",align:"center",children:[{type:"html",align:"center",id:"framepreviewtitleid",style:"font-family: Amaranth; color: #1E66EB;\tfont-size: 20px; font-weight: bold;",html:f.previewMode},{type:"html",id:"framepreviewid",align:"center",style:"width:500px;height:320px",html:""},{type:"hbox",id:"imgparamsid",style:"display:none;width:500px;",height:"325px",
children:[{type:"vbox",align:"center",width:"400px",children:[{type:"text",id:"imgtitleid",label:f.imgTitle,onChange:function(){var a=this.getDialog(),b=this.getValue();a.imagesList[m(a)][IMG_PARAM.TITLE]=b;r(a)},onBlur:function(){var a=this.getDialog(),b=this.getValue();a.imagesList[m(a)][IMG_PARAM.TITLE]=b;r(a)}},{type:"text",id:"imgdescid",label:f.imgDesc,onChange:function(){var a=this.getDialog(),b=this.getValue();a.imagesList[m(a)][IMG_PARAM.ALT]=b;r(a)},onBlur:function(){var a=this.getDialog(),
b=this.getValue();a.imagesList[m(a)][IMG_PARAM.ALT]=b;r(a)}},{type:"html",id:"imgpreviewid",style:"width:400px;height:200px;",html:"<div>xx</div>"}]}]},{type:"hbox",align:"center",height:110,widths:["25%","50%"],children:[{type:"vbox",children:[{type:"checkbox",id:"autostartid",label:f.autoStart,"default":"checked",style:"margin-top:15px;",onChange:k,commit:k,setup:p},{type:"checkbox",id:"showtitleid",label:f.showTitle,"default":"checked",onChange:k,commit:k,setup:p},{type:"checkbox",id:"showcontrolid",
label:f.showControls,"default":"checked",onChange:k,commit:k,setup:p},{type:"checkbox",id:"showthumbid",label:f.showThumbs,"default":"checked",onChange:k,commit:k,setup:p},{type:"checkbox",id:"openOnClickId",label:f.openOnClick,"default":"checked",onChange:k,commit:k,setup:p}]},{type:"select",id:"imglistitemsid",label:f.picturesList,multiple:!1,style:"height:125px;width:250px",items:[],onChange:function(){var a=this,b=a.getDialog(),a=h(a),c,e,d=0;for(c=0;c<a.getChildren().count();c+=1)if(e=a.getChild(c),
e.$.selected){d=c;break}q(a,d);l(b)}},{type:"vbox",children:[{type:"button",id:"previewbtn",style:"margin-top:15px;margin-left:25px;",label:f.previewMode,onClick:function(){t(this.getDialog())}},{type:"button",id:"removeselectedbtn",style:"margin-left:25px;",label:f.imgDelete,onClick:function(){var a=this.getDialog(),b=a.getContentElement("slideshowinfoid","imglistitemsid"),b=h(b),c,e=!1;for(c=b.getChildren().count()-1;0<=c;c--)b.getChild(c).$.selected&&(a.imagesList.splice(c,1),b.getChild(c).remove(),
e=!0);e&&(0==a.imagesList.length&&(c=BASE_PATH+"plugins/slideshow/icons/placeholder.png",i(b,"IMG_0 : "+c.substring(c.lastIndexOf("/")+1),c,a.getParentEditor().document),a.imagesList.pushUnique([c,f.imgTitle,f.imgDesc,"50","50"])),q(b,0),l(a))}},{type:"button",id:"editselectedbtn",style:"margin-left:25px;",label:f.imgEdit,onClick:function(){r(this.getDialog())}},{type:"hbox",children:[{type:"button",id:"upselectedbtn",style:"width:32px; margin-left:25px;",label:f.arrowUp,onClick:function(){u(this.getDialog(),
-1)}},{type:"button",id:"downselectedbtn",style:"width:32px;",label:f.arrowDown,onClick:function(){u(this.getDialog(),1)}}]}]}]},{type:"hbox",children:[{type:"text",id:"pictheightid",label:f.pictHeight,maxLength:3,style:"width:100px;","default":"300",onChange:function(){0==/^\d+$/.test(this.getValue())&&this.setValue(300);this.getDialog().params.updateVal(this.id,this.getValue());l(this.getDialog())},commit:k,setup:p},{type:"text",id:"speedid",label:f.displayTime,maxLength:3,style:"width:100px;",
"default":"5",onChange:function(){0==/^\d+$/.test(this.getValue())&&this.setValue(5);this.getDialog().params.updateVal(this.id,this.getValue());l(this.getDialog())},commit:k,setup:p},{type:"text",id:"animspeedid",label:f.transitionTime,style:"width:100px;",maxLength:4,"default":"500",onChange:function(){0==/^\d+$/.test(this.getValue())&&this.setValue(500);this.getDialog().params.updateVal(this.id,this.getValue());l(this.getDialog())},commit:k,setup:p},{type:"select",id:"transitiontypeid",label:f.transition,
items:[[f.tr1,"none"],[f.tr2,"resize"],[f.tr3,"slide-vert"],[f.tr4,"slide-hori"],[f.tr5,"fade"]],"default":"resize",style:"width:100px;",commit:k,setup:p,onChange:k}]}]}]}],onLoad:function(){},onShow:function(){this.dialog=this;this.slideshowDOM=null;this.openCloseStep=!0;var a=this.fakeImage=null;this.imagesList=[];this.params=[];this.previewImage=g.document.createElement("img");this.okRefresh=!0;var b=this.getSelectedElement();if(b&&b.data("cke-real-element-type")&&"slideShow"==b.data("cke-real-element-type")&&
(this.fakeImage=b,a=g.restoreRealElement(b)),a){this.slideshowDOM=a;b=a.getElementsByTag("ul");b=null==b?null:1==b.count()?b.getItem(0):null;if(null==b)return alert("BIG Problem slideShowContainer !!"),!1;var c=a.getAttribute("id");if(null==c)return alert("BIG Problem slideshowid !!"),!1;this.params.push(["slideshowid",c]);for(var e,d,h,j,k,m=b.$.getElementsByTagName("img"),p=this.getContentElement("slideshowinfoid","imglistitemsid"),b=0;b<m.length;b+=1)e=m[b],c=e.src,d=e.width,0==d&&(d=e.naturalWidth),
0==d?(d=50,h=50):(h=e.height,0==h&&(h=e.naturalHeight),0==h&&(d=50,h=50)),d/=h,k=j=50,1<d?k/=d:j*=d,e=this.imagesList.pushUnique([c,e.title,e.alt,j,k]),0<=e&&i(p,"IMG_"+e+" : "+c.substring(c.lastIndexOf("/")+1),c,this.getParentEditor().document);q(p,0);l(this);var o,a=a.$.dataset;for(o in a)this.params.push([o,a[o]]);this.setupContent(this,!0);this.newSlideShowMode=!1}else this.params.push(["slideshowid","cke_"+A(8)+"_slideShow"]),o=this.getContentElement("slideshowinfoid","imglistitemsid"),a=BASE_PATH+
"plugins/slideshow/icons/placeholder.png",i(o,"IMG_0 : "+a.substring(a.lastIndexOf("/")+1),a,this.getParentEditor().document),this.imagesList.pushUnique([a,f.imgTitle,f.imgDesc,"50","50"]),q(o,0),l(this),this.commitContent(this);this.openCloseStep=!1;t(this)},onOk:function(){return!1},onHide:function(){z(this)}}});